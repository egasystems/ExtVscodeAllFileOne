"use strict";var L=Object.create;var w=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,O=Object.prototype.hasOwnProperty;var j=(o,t)=>{for(var c in t)w(o,c,{get:t[c],enumerable:!0})},D=(o,t,c,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let l of V(t))!O.call(o,l)&&l!==c&&w(o,l,{get:()=>t[l],enumerable:!(r=I(t,l))||r.enumerable});return o};var y=(o,t,c)=>(c=o!=null?L(N(o)):{},D(t||!o||!o.__esModule?w(c,"default",{value:o,enumerable:!0}):c,o)),A=o=>D(w({},"__esModule",{value:!0}),o);var z={};j(z,{activate:()=>U,deactivate:()=>H});module.exports=A(z);var e=y(require("vscode")),p=y(require("fs")),s=y(require("path"));function x(o,t,c=!1){try{return p.readFileSync(o,"utf8")}catch{if(c)return"";e.window.showErrorMessage(`No se pudo leer el archivo ${t}: ${s.basename(o)}`);return}}function S(o,t,c){let r=o.indexOf(t),l=r===-1?0:r+t.length,i=c?o.indexOf(c):o.length;return o.substring(l,i).trim()}function U(o){console.log("\u{1F680} Extensi\xF3n activada");let t=e.commands.registerCommand("angularComponentViewer.openCombinedView",async r=>{let l=e.window.activeTextEditor,i=r?r.fsPath:l?.document.uri.fsPath;if(!i)return e.window.showErrorMessage("Selecciona o abre un archivo .component.ts");if(!(/\.ts$/.test(i)&&!/\.spec\.ts$/.test(i)))return e.window.showErrorMessage("Este no es un archivo .ts v\xE1lido (se ignoran los archivos .spec.ts)");let h,v,m=s.basename(i,".ts"),k=[`${m}.component.html`,`${m}.html`],u="";for(let n of k){let a=s.join(s.dirname(i),n);if(p.existsSync(a)){u=a;break}}u||(u=s.join(s.dirname(i),`${m}.html`));let E=[`${m}.component.css`,`${m}.css`,`${m}.component.scss`,`${m}.scss`],f="";for(let n of E){let a=s.join(s.dirname(i),n);if(p.existsSync(a)){f=a;break}}f||(f=s.join(s.dirname(i),`${m}.css`));let P=x(i,"TS"),F=x(u,"HTML",!0),$=x(f,"CSS",!0);if(P===void 0||F===void 0||$===void 0)return;let M=`// --- TypeScript ---
${P}

// --- HTML ---
${F}

// --- CSS ---
${$}`,d=s.join(s.dirname(i),`${s.basename(i).replace(".ts","")}-${Date.now()}.ts`);await e.workspace.fs.writeFile(e.Uri.file(d),Buffer.from(M,"utf8"));let g=await e.workspace.openTextDocument(d);await e.window.showTextDocument(g,e.ViewColumn.One,!1),console.log("\u{1F4C2} Archivo temporal abierto:",g.uri.fsPath);let b=e.window.activeTextEditor;b?.document===g&&(await b.edit(n=>{n.insert(new e.Position(0,0)," ")}),await b.edit(n=>{n.delete(new e.Range(new e.Position(0,0),new e.Position(0,1)))}),console.log("\u270F\uFE0F Modificaci\xF3n forzada aplicada")),v=e.workspace.onDidSaveTextDocument(async n=>{n.uri.fsPath}),o.subscriptions.push(v),h=e.workspace.onDidSaveTextDocument(n=>{if(n.uri.fsPath!==d)return;let a=n.getText();p.writeFileSync(i,S(a,"// --- TypeScript ---","// --- HTML ---")),p.writeFileSync(u,S(a,"// --- HTML ---","// --- CSS ---")),p.writeFileSync(f,S(a,"// --- CSS ---",null)),e.window.showInformationMessage("Archivos del componente actualizados \u2714\uFE0E")}),o.subscriptions.push(h);let C=e.workspace.onDidCloseTextDocument(async n=>{if(console.log("\u{1F4C1} Documento cerrado:",n.uri.fsPath),console.log("\u{1F4C1} Temporal esperado:",d),console.log("\u{1F50D} Comparando:",s.resolve(n.uri.fsPath).toLowerCase()),console.log("\u{1F50D} Con       :",s.resolve(d).toLowerCase()),s.resolve(n.uri.fsPath).toLowerCase()===s.resolve(d).toLowerCase()){console.log("\u2705 Coincidencia confirmada");try{console.log("\u{1F9F9} Intentando eliminar el archivo temporal..."),await e.workspace.fs.delete(e.Uri.file(d),{useTrash:!1}),console.log("\u2705 Archivo temporal eliminado.")}catch(a){a?.code==="FileNotFound"?console.log("\u26A0\uFE0F El archivo temporal ya hab\xEDa sido eliminado."):console.warn("\u26A0\uFE0F No se pudo borrar el archivo temporal:",a)}h.dispose(),v.dispose(),C.dispose()}});o.subscriptions.push(C),setTimeout(async()=>{if(e.workspace.textDocuments.some(a=>s.resolve(a.uri.fsPath)===s.resolve(d)))console.log("\u23F3 (Fallback) Documento a\xFAn abierto, no se elimina.");else{try{console.log("\u{1F9F9} (Fallback) Eliminando archivo temporal..."),await e.workspace.fs.delete(e.Uri.file(d),{useTrash:!1}),console.log("\u2705 (Fallback) Archivo temporal eliminado.")}catch(a){a?.code==="FileNotFound"?console.log("\u26A0\uFE0F (Fallback) El archivo temporal ya hab\xEDa sido eliminado."):console.warn("\u26A0\uFE0F (Fallback) No se pudo borrar el archivo temporal:",a)}h.dispose(),v.dispose(),C.dispose()}},5e4)});o.subscriptions.push(t);let c=e.commands.registerCommand("angularComponentViewer.cycleLanguage",async()=>{let r=e.window.activeTextEditor?.document;if(!r||!["typescript","html","css"].includes(r.languageId))return e.window.showInformationMessage("Coloca el cursor en un archivo generado por ACV con modo v\xE1lido.");let l=["typescript","html","css"],i=r.languageId,T=l.indexOf(i),h=l[(T+1)%l.length];await e.languages.setTextDocumentLanguage(r,h),e.window.showInformationMessage(`Modo del documento cambiado a: ${h.toUpperCase()}`)});o.subscriptions.push(c)}function H(){}0&&(module.exports={activate,deactivate});
